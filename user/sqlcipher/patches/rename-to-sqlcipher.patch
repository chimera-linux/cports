From 2496ab69f99a0950162bfad2b25bf563b49c44ee Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?JC=20Gr=C3=BCnhage?= <jan.christian@gruenhage.xyz>
Date: Mon, 17 Nov 2025 00:33:01 +0100
Subject: [PATCH] sqlite3 -> sqlcipher

---
 Makefile.in                      |  2 +-
 autosetup/proj.tcl               |  2 +-
 autosetup/sqlite-config.tcl      | 16 ++++++++--------
 autosetup/system.tcl             |  2 +-
 main.mk                          |  6 +++---
 sqlite3.pc.in => sqlcipher.pc.in |  2 +-
 6 files changed, 15 insertions(+), 15 deletions(-)
 rename sqlite3.pc.in => sqlcipher.pc.in (91%)

diff --git a/Makefile.in b/Makefile.in
index a597a86a..8b0d3526 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -272,7 +272,7 @@ Makefile: $(TOP)/Makefile.in $(AS_AUTO_DEF)
 	$(AS_AUTORECONFIG)
 	@touch $@
 
-sqlite3.pc: $(TOP)/sqlite3.pc.in $(AS_AUTO_DEF)
+sqlcipher.pc: $(TOP)/sqlcipher.pc.in $(AS_AUTO_DEF)
 	$(AS_AUTORECONFIG)
 	@touch $@
 install: install-pc # defined in main.mk
diff --git a/autosetup/proj.tcl b/autosetup/proj.tcl
index 86f4df44..49872b4b 100644
--- a/autosetup/proj.tcl
+++ b/autosetup/proj.tcl
@@ -1506,7 +1506,7 @@ proc proj-remap-autoconf-dir-vars {} {
     exec-prefix     exec_prefix    ${prefix}
     datadir         datadir        ${prefix}/share
     mandir          mandir         ${datadir}/man
-    includedir      includedir     ${prefix}/include
+    includedir      includedir     ${prefix}/include/sqlcipher
     bindir          bindir         ${exec_prefix}/bin
     libdir          libdir         ${exec_prefix}/lib
     sbindir         sbindir        ${exec_prefix}/sbin
diff --git a/autosetup/sqlite-config.tcl b/autosetup/sqlite-config.tcl
index 7c798b31..feb58a39 100644
--- a/autosetup/sqlite-config.tcl
+++ b/autosetup/sqlite-config.tcl
@@ -501,8 +501,8 @@ proc sqlite-configure-phase1 {buildMode} {
   }
   set srcdir $::autosetup(srcdir)
   proj-dot-ins-append $srcdir/Makefile.in
-  if {[file exists $srcdir/sqlite3.pc.in]} {
-    proj-dot-ins-append $srcdir/sqlite3.pc.in
+  if {[file exists $srcdir/sqlcipher.pc.in]} {
+    proj-dot-ins-append $srcdir/sqlcipher.pc.in
   }
   sqlite-handle-hpux; # must be relatively early so that other config tests can work
 }; # sqlite-configure-phase1
@@ -867,7 +867,7 @@ proc sqlite-handle-debug {} {
 }
 
 ########################################################################
-# "soname" for libsqlite3.so. See discussion at:
+# "soname" for libsqlcipher.so. See discussion at:
 # https://sqlite.org/src/forumpost/5a3b44f510df8ded
 proc sqlite-handle-soname {} {
   define LDFLAGS_LIBSQLITE3_SONAME ""
@@ -882,13 +882,13 @@ proc sqlite-handle-soname {} {
   }
   switch -exact -- $soname {
     none - "" { return 0 }
-    legacy    { set soname libsqlite3.so.0 }
+    legacy    { set soname libsqlcipher.so.0 }
     default {
-      if {[string match libsqlite3.* $soname]} {
+      if {[string match libsqlcipher.* $soname]} {
         # use it as-is
       } else {
         # Assume it's a suffix
-        set soname "libsqlite3.so.${soname}"
+        set soname "libsqlcipher.so.${soname}"
       }
     }
   }
@@ -2000,7 +2000,7 @@ proc sqlite-check-tcl {} {
       }
     }
     if {![file-isexec $with_tclsh]} {
-      proj-warn "Cannot find a usable tclsh (tried: $tryThese)
+      proj-warn "Cannot find a usable tclsh (tried: $tryThese)"
     }
   }
   define TCLSH_CMD $with_tclsh
@@ -2021,7 +2021,7 @@ proc sqlite-check-tcl {} {
           [catch {exec echo "puts stdout \$auto_path" | "$with_tclsh"} result] == 0} {
         foreach i $result {
           if {[file isdir $i]} {
-            set tcllibdir $i/sqlite${sq3Ver}
+            set tcllibdir $i/sqlcipher
             break
           }
         }
diff --git a/autosetup/system.tcl b/autosetup/system.tcl
index 05d378af..4c304d25 100644
--- a/autosetup/system.tcl
+++ b/autosetup/system.tcl
@@ -380,7 +380,7 @@ proc system-init {} {
 		sharedstatedir /com
 		infodir /share/info
 		mandir /share/man
-		includedir /include
+		includedir /include/sqlcipher
 	} {
 		define $name [opt-str $name o $prefix$defpath]
 	}
diff --git a/main.mk b/main.mk
index c6bdeafa..33cc0760 100644
--- a/main.mk
+++ b/main.mk
@@ -137,7 +137,7 @@ B.tclsh ?= $(JIMSH)
 prefix      ?= /usr/local
 datadir     ?= $(prefix)/share
 mandir      ?= $(datadir)/man
-includedir  ?= $(prefix)/include
+includedir  ?= $(prefix)/include/sqlcipher
 exec_prefix ?= $(prefix)
 bindir      ?= $(exec_prefix)/bin
 libdir      ?= $(exec_prefix)/lib
@@ -2267,8 +2267,8 @@ install: install-man1
 #
 # sqlite3.pc is typically generated by the configure script but could
 # conceivably be generated by hand.
-install-pc: sqlite3.pc $(install-dir.pkgconfig)
-	$(INSTALL.noexec) sqlite3.pc "$(install-dir.pkgconfig)"
+install-pc: sqlcipher.pc $(install-dir.pkgconfig)
+	$(INSTALL.noexec) sqlcipher.pc "$(install-dir.pkgconfig)"
 
 scrub$(T.exe):	$(TOP)/ext/misc/scrub.c sqlite3.o
 	$(T.link) -o $@ -I. -DSCRUB_STANDALONE \
diff --git a/sqlite3.pc.in b/sqlcipher.pc.in
similarity index 91%
rename from sqlite3.pc.in
rename to sqlcipher.pc.in
index 723dd515..b00e216d 100644
--- a/sqlite3.pc.in
+++ b/sqlcipher.pc.in
@@ -8,6 +8,6 @@ includedir=@includedir@
 Name: SQLite
 Description: SQL database engine
 Version: @PACKAGE_VERSION@
-Libs: -L${libdir} -lsqlite3
+Libs: -L${libdir} -lsqlcipher
 Libs.private: @LDFLAGS_MATH@ @LDFLAGS_ZLIB@ @LDFLAGS_DLOPEN@ @LDFLAGS_PTHREAD@ @LDFLAGS_ICU@
 Cflags: -I${includedir}
-- 
2.52.0

