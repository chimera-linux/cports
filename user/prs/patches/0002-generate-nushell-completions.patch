From 72f6c99b93da43504e4d41283d70210d89887304 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?JC=20Gr=C3=BCnhage?= <jan.christian@gruenhage.xyz>
Date: Sun, 26 Oct 2025 22:12:23 +0100
Subject: [PATCH 2/2] generate nushell completions

---
 Cargo.lock                                  | 11 +++++++++++
 cli/Cargo.toml                              |  1 +
 cli/src/action/internal/completions.rs      |  3 +++
 cli/src/cmd/matcher/internal/completions.rs |  5 +++++
 cli/src/cmd/subcmd/internal/completions.rs  | 10 +++++++++-
 5 files changed, 29 insertions(+), 1 deletion(-)

diff --git a/Cargo.lock b/Cargo.lock
index 2760272..e484e83 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -689,6 +689,16 @@ dependencies = [
  "clap",
 ]
 
+[[package]]
+name = "clap_complete_nushell"
+version = "4.5.9"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "811159f339691baacdf7d534df2946b9d217014081099e23d31d887d99521e70"
+dependencies = [
+ "clap",
+ "clap_complete",
+]
+
 [[package]]
 name = "clap_derive"
 version = "4.5.47"
@@ -3860,6 +3870,7 @@ dependencies = [
  "chbs",
  "clap",
  "clap_complete",
+ "clap_complete_nushell",
  "colored",
  "copypasta-ext",
  "crossterm 0.29.0",
diff --git a/cli/Cargo.toml b/cli/Cargo.toml
index 01c6216..86cdeb3 100644
--- a/cli/Cargo.toml
+++ b/cli/Cargo.toml
@@ -122,6 +122,7 @@ qr2term = { version = "0.3", optional = true }
 
 # Clipboard support
 base64 = { version = "0.22", optional = true }
+clap_complete_nushell = "4.5.9"
 
 # Clipboard support for non-X11/Wayland
 [target.'cfg(not(all(unix, not(any(target_os="macos", target_os="android", target_os="emscripten")))))'.dependencies]
diff --git a/cli/src/action/internal/completions.rs b/cli/src/action/internal/completions.rs
index ff2cf02..417831f 100644
--- a/cli/src/action/internal/completions.rs
+++ b/cli/src/action/internal/completions.rs
@@ -108,6 +108,9 @@ where
         // TODO: patch other completion scripts to complete secret names
         Shell::Elvish => clap_complete::generate(shells::Elvish, app, bin_name, buf),
         Shell::Fish => clap_complete::generate(shells::Fish, app, bin_name, buf),
+        Shell::Nushell => {
+            clap_complete::generate(clap_complete_nushell::Nushell, app, bin_name, buf)
+        }
         Shell::PowerShell => clap_complete::generate(shells::PowerShell, app, bin_name, buf),
     }
 }
diff --git a/cli/src/cmd/matcher/internal/completions.rs b/cli/src/cmd/matcher/internal/completions.rs
index d6a0c9a..73dd51c 100644
--- a/cli/src/cmd/matcher/internal/completions.rs
+++ b/cli/src/cmd/matcher/internal/completions.rs
@@ -80,6 +80,7 @@ pub(crate) enum Shell {
     Bash,
     Elvish,
     Fish,
+    Nushell,
     PowerShell,
     Zsh,
 }
@@ -91,6 +92,7 @@ impl Shell {
             Shell::Bash,
             Shell::Elvish,
             Shell::Fish,
+            Shell::Nushell,
             Shell::PowerShell,
             Shell::Zsh,
         ]
@@ -102,6 +104,7 @@ impl Shell {
             "bash" => Some(Shell::Bash),
             "elvish" => Some(Shell::Elvish),
             "fish" => Some(Shell::Fish),
+            "nushell" | "nu" => Some(Shell::Nushell),
             "powershell" | "ps" => Some(Shell::PowerShell),
             "zsh" => Some(Shell::Zsh),
             _ => None,
@@ -114,6 +117,7 @@ impl Shell {
             Shell::Bash => "bash",
             Shell::Elvish => "elvish",
             Shell::Fish => "fish",
+            Shell::Nushell => "nushell",
             Shell::PowerShell => "powershell",
             Shell::Zsh => "zsh",
         }
@@ -125,6 +129,7 @@ impl Shell {
             Shell::Bash => format!("{bin_name}.bash"),
             Shell::Elvish => format!("{bin_name}.elv"),
             Shell::Fish => format!("{bin_name}.fish"),
+            Shell::Nushell => format!("{bin_name}.nu"),
             Shell::PowerShell => format!("_{bin_name}.ps1"),
             Shell::Zsh => format!("_{bin_name}"),
         }
diff --git a/cli/src/cmd/subcmd/internal/completions.rs b/cli/src/cmd/subcmd/internal/completions.rs
index a25f257..3cebf0c 100644
--- a/cli/src/cmd/subcmd/internal/completions.rs
+++ b/cli/src/cmd/subcmd/internal/completions.rs
@@ -22,7 +22,15 @@ impl CmdCompletions {
                     // TODO: replace this by a runtime list
                     // Issue: https://github.com/clap-rs/clap/issues/4504#issuecomment-1326379595
                     // .value_parser(shell_variants)
-                    .value_parser(["all", "bash", "zsh", "fish", "elvish", "powershell"])
+                    .value_parser([
+                        "all",
+                        "bash",
+                        "zsh",
+                        "fish",
+                        "elvish",
+                        "powershell",
+                        "nushell",
+                    ])
                     .ignore_case(true),
             )
             .arg(
-- 
2.51.1

